<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd
                        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

   
    <changeSet id="20250722-remove-processamento-id-from-coleta" author="diego.leonardo">
        
        <!-- Drop foreign key constraint -->
        <dropForeignKeyConstraint 
            baseTableName="coleta" 
            constraintName="fk_coleta__processamento_id"/>
        
        <!-- Drop unique constraint (if exists) -->
        <dropUniqueConstraint 
            tableName="coleta" 
            constraintName="ux_coleta__processamento_id"/>
        
        <!-- Drop index (if exists) -->
        <sql>
            <comment>Drop index for processamento_id if it exists</comment>
            DROP INDEX IF EXISTS ux_coleta__processamento_id;
        </sql>
        
        <!-- Drop the processamento_id column -->
        <dropColumn tableName="coleta" columnName="processamento_id"/>
        
        <!-- Add comment to document the change -->
        <sql>
            <comment>Coleta table now allows independent creation without processamento reference</comment>
            COMMENT ON TABLE coleta IS 'Coleta can be created independently. Processamento references coleta via coleta_id.';
        </sql>
        
    </changeSet>

</databaseChangeLog>